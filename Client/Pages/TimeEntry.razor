@layout WindowLayoutLayout
@page "/timeentry/{TicketId}"

@attribute [Authorize]

<PageTitle>Time Entry @ticket?.item?.ticketNumber | @company?.item?.companyName | @ticket?.item?.title</PageTitle>
<RadzenRow Visible="@(pageLoading)" AlignItems="Radzen.AlignItems.Center" JustifyContent="Radzen.JustifyContent.Center">
    <RadzenStack>
        <RadzenProgressBarCircular Mode="Radzen.ProgressBarMode.Indeterminate" ShowValue="false" Visible="@(pageLoading)" Size="Radzen.ProgressBarCircularSize.Large">

        </RadzenProgressBarCircular>
    </RadzenStack>
</RadzenRow>
<RadzenRow Visible="@(!pageLoading)">
    <RadzenColumn SizeXL="9" SizeLG="8">
       <RadzenStack>
            <RadzenStack Orientation="Radzen.Orientation.Horizontal">
                <RadzenText Text="@($"{ticket?.item?.ticketNumber} - {ticket?.item?.title}")" TextStyle="Radzen.Blazor.TextStyle.H4" />
            </RadzenStack>
<RadzenStack Orientation="Radzen.Orientation.Horizontal">
                <strong>Priority: </strong><RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Danger" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Critical")" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge> 
                                           <RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Warning" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "High")" Style="background-color: darkorange; padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold; color: #000000" />
                                               </RadzenStack>
                                           </RadzenBadge>
<RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Success" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Medium")" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold; color: #000000" />
                                               </RadzenStack>
                                           </RadzenBadge>
<RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Info" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Low")" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge>
<RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Light" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Very Low")" Shade="Radzen.Shade.Lighter" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge>
                                           <RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Light" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Information")" Shade="Radzen.Shade.Lighter" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge>
                                           <RadzenBadge Text="@PriorityName" BadgeStyle="Radzen.BadgeStyle.Danger" IsPill="true" Variant="Radzen.Variant.Filled" Visible="@(PriorityName == "Undetermined")" Shade="Radzen.Shade.Dark" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@PriorityName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge>
                <strong>Status: </strong>
                <RadzenBadge Text="@StatusName" BadgeStyle="Radzen.BadgeStyle.Info" IsPill="true" Variant="Radzen.Variant.Filled" Shade="Radzen.Shade.Dark" Style="padding-left: 10px; padding-right: 10px">
                                               <RadzenStack Style="width: 100%">
                                                   <RadzenText Text="@StatusName" Style="font-weight: bold" />
                                               </RadzenStack>
                                           </RadzenBadge>
                
            </RadzenStack>
<RadzenStack Orientation="Radzen.Orientation.Vertical">
                <RadzenStack Orientation="Radzen.Orientation.Horizontal">
                    <strong>Account: </strong>@company?.item?.companyName
                    <strong>Contact: </strong>@contact?.item?.firstName @contact?.item?.lastName                                             
                    <strong>Phone: </strong><RadzenButton Size="Radzen.ButtonSize.Small" Icon="call" Visible="@(!string.IsNullOrEmpty(contact?.item?.phone))" Click="@CallContactPhoneButtonClick"></RadzenButton>@contact?.item?.phone
                    <strong>Ext: </strong>@contact?.item?.extension
                    <strong>Mobile: </strong><RadzenButton Size="Radzen.ButtonSize.Small" Icon="call" Visible="@(!string.IsNullOrEmpty(contact?.item?.mobilePhone))" Click="@CallContactMobileButtonClick"></RadzenButton>@contact?.item?.mobilePhone

                </RadzenStack>
            </RadzenStack>
            <RadzenStack>
                <RadzenTemplateForm TItem="CrownATTime.Server.Models.ATTime.TimeEntry" Data="@timeEntryRecord" Visible="@(timeEntryRecord != null)" Submit="@TemplateForm0Submit">
                    <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Role" Component="RoleId" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                          <RadzenDropDown TValue="int" @bind-Value="timeEntryRecord.RoleId" Data="mappedRoles" ValueProperty="id" TextProperty="name" Name="RoleId" Style="width: 100%" Change="@RoleIdChange"></RadzenDropDown>
                          <RadzenNumericRangeValidator Component="RoleId" Text="Role is required" Min="1"></RadzenNumericRangeValidator>
                        </RadzenColumn>
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Billing Code" Component="BillingCodeId" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                            <RadzenDropDown TValue="int" @bind-Value="timeEntryRecord.BillingCodeId" Data="billingCodes" ValueProperty="id" TextProperty="name" Name="BillingCodeId" Style="width: 100%" Change="@BillingCodeIdChange"></RadzenDropDown>
                          <RadzenNumericRangeValidator Component="BillingCodeId" Text="Billing Code is required" Min="1"></RadzenNumericRangeValidator>
                        </RadzenColumn>
                    </RadzenRow>
                    
                    <RadzenRow style="margin-bottom: 1rem" Visible="@(timeEntryRecord != null)" AlignItems="Radzen.AlignItems.Center">
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Contract" Component="ContractId" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="10">
                            <RadzenDropDown TValue="int?" @bind-Value="timeEntryRecord.ContractId" Data="contracts" ValueProperty="Id" TextProperty="ContractName" Name="ContractId" Style="width: 100%" Change="@ContractIdChange"></RadzenDropDown>
                            <RadzenNumericRangeValidator Component="ContractId" Text="Contract is required" Min="1"></RadzenNumericRangeValidator>
                        </RadzenColumn>
                    </RadzenRow>
                    <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Start Date Time" Component="StartDateTime" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                          <RadzenDatePicker style="display: block; width: 100%" @bind-Value="timeEntryRecord.StartDateTime" Name="StartDateTime" ShowTime="true" Kind="System.DateTimeKind.Local" HourFormat="12" Change="@StartDateTimeChange" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="End Date Time" Component="EndDateTime" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                          <RadzenDatePicker style="display: block; width: 100%" @bind-Value="timeEntryRecord.EndDateTime" Name="EndDateTime" ShowTime="true" Kind="System.DateTimeKind.Local" HourFormat="12" Change="@EndDateTimeChange" />
                        </RadzenColumn>
                    </RadzenRow>
                    
                    <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Hours Worked" Component="HoursWorked" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                          <RadzenNumeric style="display: block; width: 100%" TValue="decimal?" @bind-Value="timeEntryRecord.HoursWorked" Name="HoursWorked" Step=".25" Change="@HoursWorkedChange" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="3" SizeLG="2">
                            <RadzenLabel Text="Offset Hours" Component="OffsetHours" style="width: 100%" />
                        </RadzenColumn>
                        <RadzenColumn SizeMD="9" SizeLG="4">
                            <RadzenNumeric style="display: block; width: 100%" TValue="decimal?" @bind-Value="timeEntryRecord.OffsetHours" Name="OffsetHours" Step=".25" Change="@OffsetHoursChange" />
                        </RadzenColumn>
                    </RadzenRow>
                    <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                    
                        <RadzenColumn SizeMD="3">
                            <RadzenLabel Text="Is Non Billable?" Component="IsNonBillable" style="width: 100%" />
                            <RadzenCheckBox @bind-Value="timeEntryRecord.IsNonBillable" Name="IsNonBillable" TValue="bool" Change="@IsNonBillableChange" />

                        </RadzenColumn>
                        
                        <RadzenColumn SizeMD="3">
                            <RadzenLabel Text="Show On Invoice?" Component="ShowOnInvoice" style="width: 100%" />
                            <RadzenCheckBox @bind-Value="timeEntryRecord.ShowOnInvoice" Name="ShowOnInvoice" TValue="bool" Change="@ShowOnInvoiceChange" />

                        </RadzenColumn>
                       
                    </RadzenRow>
                    
                    <RadzenRow style="margin-bottom: 1rem">
                        <RadzenColumn SizeMD="6">
                            <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                                <RadzenLabel Text="Summary Notes" Component="SummaryNotes" style="width: 100%" />
                            </RadzenRow>
                            <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                                <RadzenHtmlEditor @bind-Value="timeEntryRecord.SummaryNotes" Name="SummaryNotes" Style="height: 300px; width: 100%" Change="@SummaryNotesChange">
                                    <RadzenHtmlEditorUndo></RadzenHtmlEditorUndo>
                                    <RadzenHtmlEditorRedo></RadzenHtmlEditorRedo>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorBold></RadzenHtmlEditorBold>
                                    <RadzenHtmlEditorItalic></RadzenHtmlEditorItalic>
                                    <RadzenHtmlEditorUnderline></RadzenHtmlEditorUnderline>
                                    <RadzenHtmlEditorStrikeThrough></RadzenHtmlEditorStrikeThrough>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorAlignLeft></RadzenHtmlEditorAlignLeft>
                                    <RadzenHtmlEditorAlignCenter></RadzenHtmlEditorAlignCenter>
                                    <RadzenHtmlEditorAlignRight></RadzenHtmlEditorAlignRight>
                                    <RadzenHtmlEditorJustify></RadzenHtmlEditorJustify>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorIndent></RadzenHtmlEditorIndent>
                                    <RadzenHtmlEditorOutdent></RadzenHtmlEditorOutdent>
                                    <RadzenHtmlEditorUnorderedList></RadzenHtmlEditorUnorderedList>
                                    <RadzenHtmlEditorOrderedList></RadzenHtmlEditorOrderedList>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorRemoveFormat></RadzenHtmlEditorRemoveFormat>
                                    <RadzenHtmlEditorLink></RadzenHtmlEditorLink>
                                    <RadzenHtmlEditorUnlink></RadzenHtmlEditorUnlink>
                                </RadzenHtmlEditor>
                            </RadzenRow>
                        </RadzenColumn>
                        <RadzenColumn SizeMD="6">
                            <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                                    <RadzenLabel Text="Internal Notes" Component="InternalNotes" style="width: 100%; color: var(--rz-danger)" />
                            </RadzenRow>
                            <RadzenRow style="margin-bottom: 1rem" AlignItems="Radzen.AlignItems.Center">
                                    <RadzenHtmlEditor Name="InternalNotes" @bind-Value="timeEntryRecord.InternalNotes" Style="height: 300px; width: 100%" Change="@InternalNotesChange">
                                    <RadzenHtmlEditorUndo></RadzenHtmlEditorUndo>
                                    <RadzenHtmlEditorRedo></RadzenHtmlEditorRedo>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorBold></RadzenHtmlEditorBold>
                                    <RadzenHtmlEditorItalic></RadzenHtmlEditorItalic>
                                    <RadzenHtmlEditorUnderline></RadzenHtmlEditorUnderline>
                                    <RadzenHtmlEditorStrikeThrough></RadzenHtmlEditorStrikeThrough>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorAlignLeft></RadzenHtmlEditorAlignLeft>
                                    <RadzenHtmlEditorAlignCenter></RadzenHtmlEditorAlignCenter>
                                    <RadzenHtmlEditorAlignRight></RadzenHtmlEditorAlignRight>
                                    <RadzenHtmlEditorJustify></RadzenHtmlEditorJustify>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorIndent></RadzenHtmlEditorIndent>
                                    <RadzenHtmlEditorOutdent></RadzenHtmlEditorOutdent>
                                    <RadzenHtmlEditorUnorderedList></RadzenHtmlEditorUnorderedList>
                                    <RadzenHtmlEditorOrderedList></RadzenHtmlEditorOrderedList>
                                    <RadzenHtmlEditorSeparator></RadzenHtmlEditorSeparator>
                                    <RadzenHtmlEditorRemoveFormat></RadzenHtmlEditorRemoveFormat>
                                    <RadzenHtmlEditorLink></RadzenHtmlEditorLink>
                                    <RadzenHtmlEditorUnlink></RadzenHtmlEditorUnlink>
                                    </RadzenHtmlEditor>
                            </RadzenRow>
                        </RadzenColumn>

                        
                        
                        
                    </RadzenRow>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.End">
                            <RadzenButton ButtonStyle="ButtonStyle.Primary" ButtonType="ButtonType.Submit" Icon="save" Text="Complete" Variant="Variant.Flat" />
                    </RadzenStack>
                </RadzenTemplateForm>
            
            </RadzenStack>
       </RadzenStack>
    </RadzenColumn>
    <RadzenColumn SizeXL="2" SizeLG="4">
        <iframe class="responsive-iframe" src="@(rocketshipUrl)"></iframe>
    </RadzenColumn>
</RadzenRow>

<style>

    .responsive-iframe {
      /* position: absolute; */
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      width: 100%;
      height: 91vh;
      border: none;
    }
</style>